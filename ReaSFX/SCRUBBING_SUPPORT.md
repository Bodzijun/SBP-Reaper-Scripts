# Smart Loop - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∫—Ä–∞–±–ª–∏–Ω–≥–∞ Edit Cursor

## ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∫—Ä–∞–±–ª–∏–Ω–≥–∞

### –ù–æ–≤—ã–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã Smart Loop

–¢–µ–ø–µ—Ä—å Smart Loop —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ **3 —Ä–µ–∂–∏–º–∞—Ö** —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º:

1. **Time Selection** (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)
2. **Cursor Scrubbing** (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2) ‚≠ê –ù–û–í–û–ï
3. **Key Hold Duration** (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 - fallback)

---

## üéØ –†–µ–∂–∏–º Cursor Scrubbing

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ù–∞–∂–º–∏—Ç–µ –∏ —É–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ K** –≤ —Ä–µ–∂–∏–º–µ Smart Loop
2. **–î–≤–∏–≥–∞–π—Ç–µ Edit Cursor** (—Å–∫—Ä–∞–±–ª–∏–Ω–≥ - –Ω–∞–ø—Ä–∏–º–µ—Ä, –º—ã—à–∫–æ–π –ø–æ timeline)
3. **–û—Ç–ø—É—Å—Ç–∏—Ç–µ K**
4. –°–∫—Ä–∏–ø—Ç –∑–∞–ø–æ–ª–Ω–∏—Ç –¥–∏–∞–ø–∞–∑–æ–Ω –æ—Ç **–Ω–∞—á–∞–ª—å–Ω–æ–π** –¥–æ **–∫–æ–Ω–µ—á–Ω–æ–π** –ø–æ–∑–∏—Ü–∏–∏ –∫—É—Ä—Å–æ—Ä–∞

### –ü—Ä–∏–º–µ—Ä:

```
1. –ö—É—Ä—Å–æ—Ä –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ 0.00
2. –ù–∞–∂–∞–ª–∏ K ‚Üí start_pos = 0.00
3. –î–≤–∏–≥–∞–µ—Ç–µ –∫—É—Ä—Å–æ—Ä –¥–æ 10.00 (—Å–∫—Ä–∞–±–ª–∏–Ω–≥)
4. –û—Ç–ø—É—Å—Ç–∏–ª–∏ K ‚Üí end_pos = 10.00
5. –ó–∞–ø–æ–ª–Ω–µ–Ω –¥–∏–∞–ø–∞–∑–æ–Ω 0.00 - 10.00 —Å START ‚Üí LOOP ‚Üí RELEASE
```

### Use Case:

**–î–ª—è —Ñ–æ–ª–∏:**
- –°–º–æ—Ç—Ä–∏—Ç–µ –≤–∏–¥–µ–æ
- –ù–∞–∂–∏–º–∞–µ—Ç–µ K –≤ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞ –¥–≤–∏–∂–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
- –î–≤–∏–≥–∞–µ—Ç–µ –∫—É—Ä—Å–æ—Ä –≤–º–µ—Å—Ç–µ —Å –¥–≤–∏–∂–µ–Ω–∏–µ–º (—Å–∫—Ä–∞–±–ª–∏–Ω–≥)
- –û—Ç–ø—É—Å–∫–∞–µ—Ç–µ K –≤ –º–æ–º–µ–Ω—Ç –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏—è
- ‚Üí Footsteps –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –Ω–∞ –Ω—É–∂–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω!

---

## üìä –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä–µ–∂–∏–º–æ–≤

### Priority 1: Time Selection (–µ—Å–ª–∏ –µ—Å—Ç—å)
```lua
if has_time_sel then
    fill_start = ts_start
    fill_end = ts_end
end
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- –ï—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è Time Selection –≤ –ø—Ä–æ–µ–∫—Ç–µ
- **–ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç** cursor scrubbing –∏ key hold

### Priority 2: Cursor Scrubbing (–µ—Å–ª–∏ –∫—É—Ä—Å–æ—Ä –¥–≤–∏–≥–∞–ª—Å—è)
```lua
elseif abs(current_cursor - start_pos) > 0.01 then
    fill_start = min(start_pos, current_cursor)
    fill_end = max(start_pos, current_cursor)
end
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- –ù–ï–¢ Time Selection
- –ö—É—Ä—Å–æ—Ä —Å–¥–≤–∏–Ω—É–ª—Å—è –Ω–∞ > 0.01 —Å–µ–∫ —Å –º–æ–º–µ–Ω—Ç–∞ –Ω–∞–∂–∞—Ç–∏—è K

**–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –°–∫—Ä–∞–±–ª–∏–Ω–≥ –≤–ø–µ—Ä–µ–¥: start_pos ‚Üí current_cursor
- –°–∫—Ä–∞–±–ª–∏–Ω–≥ –Ω–∞–∑–∞–¥: current_cursor ‚Üí start_pos (min/max –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

### Priority 3: Key Hold Duration (fallback)
```lua
else
    fill_start = start_pos
    fill_end = end_pos  -- —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É –Ω–∞–∂–∞—Ç–∏–µ–º/–æ—Ç–ø—É—Å–∫–∞–Ω–∏–µ–º K
end
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- –ù–ï–¢ Time Selection
- –ö—É—Ä—Å–æ—Ä –ù–ï –¥–≤–∏–≥–∞–ª—Å—è (< 0.01 —Å–µ–∫)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–¥–µ—Ä–∂–∞–Ω–∏—è K

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: Cursor Scrubbing –≤–ø–µ—Ä–µ–¥

**Steps:**
1. Set Trigger Mode = Smart Loop
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫—É—Ä—Å–æ—Ä –Ω–∞ 0.00
3. –ù–∞–∂–º–∏—Ç–µ –∏ **–î–ï–†–ñ–ò–¢–ï** K
4. –î–≤–∏–≥–∞–π—Ç–µ –∫—É—Ä—Å–æ—Ä –¥–æ 5.00 (—Å–∫—Ä–∞–±–ª–∏–Ω–≥ –º—ã—à–∫–æ–π)
5. –û—Ç–ø—É—Å—Ç–∏—Ç–µ K

**Expected:**
- Status log: `"Using cursor scrub: 0.00 to 5.00 (scrubbed 5.00s)"`
- Timeline –∑–∞–ø–æ–ª–Ω–µ–Ω –æ—Ç 0.00 –¥–æ 5.00

### –¢–µ—Å—Ç 2: Cursor Scrubbing –Ω–∞–∑–∞–¥

**Steps:**
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫—É—Ä—Å–æ—Ä –Ω–∞ 10.00
2. –ù–∞–∂–º–∏—Ç–µ –∏ –î–ï–†–ñ–ò–¢–ï K
3. –î–≤–∏–≥–∞–π—Ç–µ –∫—É—Ä—Å–æ—Ä –¥–æ 5.00 (–Ω–∞–∑–∞–¥)
4. –û—Ç–ø—É—Å—Ç–∏—Ç–µ K

**Expected:**
- Status log: `"Using cursor scrub: 5.00 to 10.00 (scrubbed 5.00s)"`
- Timeline –∑–∞–ø–æ–ª–Ω–µ–Ω –æ—Ç 5.00 –¥–æ 10.00 (min/max —Å—Ä–∞–±–æ—Ç–∞–ª)

### –¢–µ—Å—Ç 3: Time Selection –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–∫—Ä–∞–±–ª–∏–Ω–≥

**Steps:**
1. –°–æ–∑–¥–∞–π—Ç–µ Time Selection: 0.00 - 3.00
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫—É—Ä—Å–æ—Ä –Ω–∞ 5.00
3. –ù–∞–∂–º–∏—Ç–µ K
4. –î–≤–∏–≥–∞–π—Ç–µ –∫—É—Ä—Å–æ—Ä –¥–æ 10.00
5. –û—Ç–ø—É—Å—Ç–∏—Ç–µ K

**Expected:**
- Status log: `"Using time selection: 0.00 to 3.00"`
- Timeline –∑–∞–ø–æ–ª–Ω–µ–Ω 0.00 - 3.00 (–ù–ï 5.00-10.00!)
- **Time Selection –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**

### –¢–µ—Å—Ç 4: Fallback –Ω–∞ Key Hold (–±–µ–∑ –¥–≤–∏–∂–µ–Ω–∏—è)

**Steps:**
1. –ù–ï–¢ Time Selection
2. –ù–∞–∂–º–∏—Ç–µ –∏ –î–ï–†–ñ–ò–¢–ï K (3 —Å–µ–∫—É–Ω–¥—ã)
3. –ù–ï –¥–≤–∏–≥–∞–π—Ç–µ –∫—É—Ä—Å–æ—Ä!
4. –û—Ç–ø—É—Å—Ç–∏—Ç–µ K

**Expected:**
- Status log: `"Using key hold: 0.00 to 3.00"` (–ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è

---

## üîç –û—Ç–ª–∞–¥–∫–∞ –º–∞—Ä–∫–µ—Ä–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞: "Captured 1 events (0 smart splits)"

–î–æ–±–∞–≤–ª–µ–Ω—ã debug logs –≤ `ParseSmartMarkers()`:

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º:**
```
Status Log –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å:
"ParseSmartMarkers: found 4 take markers"
"  Marker 0: name='S', pos=0.500"
"  Trimmed name: 'S'"
"  Marker 1: name='L', pos=1.000"
"  Trimmed name: 'L'"
...
```

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

**1. –ú–∞—Ä–∫–µ—Ä—ã –Ω–∞–∑–≤–∞–Ω—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
```
‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: S, L, E, R (–∑–∞–≥–ª–∞–≤–Ω—ã–µ)
‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: s, l, e, r (—Å—Ç—Ä–æ—á–Ω—ã–µ)
‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: Start, Loop, End, Release
‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: " S " (—Å –ø—Ä–æ–±–µ–ª–∞–º–∏ - –Ω–æ —Ç–µ–ø–µ—Ä—å trim —Ä–∞–±–æ—Ç–∞–µ—Ç)
```

**2. –ú–∞—Ä–∫–µ—Ä—ã –≤ timeline, –Ω–µ –≤ take:**
- –ú–∞—Ä–∫–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **Take markers** (item), –Ω–µ Project markers!
- –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ item ‚Üí **Take markers**

**3. –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ take:**
- Item –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π take (–∞—É–¥–∏–æ)

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. –í—ã–¥–µ–ª–∏—Ç–µ item
2. –ù–∞–∂–º–∏—Ç–µ CAPTURE (+)
3. –°–º–æ—Ç—Ä–∏—Ç–µ Status Log
4. –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è: `"ParseSmartMarkers: found N take markers"`

---

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

#### ParseSmartMarkers() - –¥–æ–±–∞–≤–ª–µ–Ω trim
```lua
local n = name:upper():match("^%s*(.-)%s*$")  -- –£–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–±–µ–ª—ã
```

–¢–µ–ø–µ—Ä—å –º–∞—Ä–∫–µ—Ä—ã " S " (—Å –ø—Ä–æ–±–µ–ª–∞–º–∏) —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç.

#### SmartLoopRelease() - –¥–æ–±–∞–≤–ª–µ–Ω cursor scrubbing
```lua
local current_cursor = r.GetCursorPosition()

if has_time_sel then
    -- Priority 1
elseif math.abs(current_cursor - start_pos) > 0.01 then
    -- Priority 2: Cursor scrubbing
    fill_start = math.min(start_pos, current_cursor)
    fill_end = math.max(start_pos, current_cursor)
else
    -- Priority 3: Key hold
end
```

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å:

- [ ] ‚úÖ Time Selection (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)
- [ ] ‚úÖ Cursor Scrubbing –≤–ø–µ—Ä–µ–¥
- [ ] ‚úÖ Cursor Scrubbing –Ω–∞–∑–∞–¥ (auto min/max)
- [ ] ‚úÖ Key Hold fallback (–µ—Å–ª–∏ –∫—É—Ä—Å–æ—Ä –Ω–µ –¥–≤–∏–≥–∞–ª—Å—è)
- [ ] ‚úÖ Debug logs –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã
- [ ] ‚úÖ Trim –ø—Ä–æ–±–µ–ª–æ–≤ –≤ –∏–º–µ–Ω–∞—Ö –º–∞—Ä–∫–µ—Ä–æ–≤

---

## üöÄ Workflow –¥–ª—è —Ñ–æ–ª–∏

**–¢–∏–ø–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:**

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:**
   - –ó–∞—Ö–≤–∞—Ç–∏—Ç–µ footsteps —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏ S/L/E/R
   - Set = S1, Trigger Mode = Smart Loop

2. **–†–∞–±–æ—Ç–∞ —Å –≤–∏–¥–µ–æ:**
   - –ò–≥—Ä–∞–π—Ç–µ timeline –∏–ª–∏ —Å–∫—Ä–∞–±–ª–∏—Ç–µ
   - –í–∏–¥–∏—Ç–µ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞ —Ö–æ–¥—å–±—ã ‚Üí **–Ω–∞–∂–º–∏—Ç–µ K**
   - –î–≤–∏–≥–∞–π—Ç–µ –∫—É—Ä—Å–æ—Ä –≤–º–µ—Å—Ç–µ —Å –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º (—Å–∫—Ä–∞–±–ª–∏–Ω–≥)
   - –ü–µ—Ä—Å–æ–Ω–∞–∂ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è ‚Üí **–æ—Ç–ø—É—Å—Ç–∏—Ç–µ K**
   - ‚Üí Footsteps –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã!

3. **–î–ª—è —Ç–æ—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Time Selection –≤–º–µ—Å—Ç–æ —Å–∫—Ä–∞–±–ª–∏–Ω–≥–∞
   - –í—ã–¥–µ–ª–∏—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω ‚Üí –Ω–∞–∂–º–∏—Ç–µ K

---

**–í–µ—Ä—Å–∏—è:** 2.0.3
**–î–∞—Ç–∞:** 2026-01-21
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Cursor Scrubbing –¥–æ–±–∞–≤–ª–µ–Ω, Debug logs –¥–æ–±–∞–≤–ª–µ–Ω—ã
